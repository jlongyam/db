/*!
  Copyright (c) 2021 jlongyam
  https://github.com/jlongyam/cpsr
  MIT License
  version 1.0.1
*/
function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}!function(a){function b(d,a){if(a)return null===d?"[object Null]":Object.prototype.toString.call(d);if(null==d)return(d+"").toLowerCase();var b=Object.prototype.toString.call(d).slice(8,-1).toLowerCase();return"generatorfunction"===b?"function":b.match(/^(array|bigint|date|error|function|generator|regexp|symbol)$/)?b:"object"==_typeof(d)||"function"==typeof d?"object":_typeof(d)}function c(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:2;return function(b){if(0===a)return"0 Bytes";var c=0>b?0:b,b=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,b)).toFixed(c))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][b]}(b)}Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))},Storage.prototype.getObject=function(a){return JSON.parse(this.getItem(a))};var d=function(){"use strict";function a(){var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"cpsr";_classCallCheck(this,a),_defineProperty(this,"file_info",{name:"",type:"",size:"",lastModified:""}),_defineProperty(this,"file_mime",{primary:"",secondary:""}),_defineProperty(this,"file_value",""),_defineProperty(this,"file_content",""),_defineProperty(this,"storage_exists",!1),this.name=c,"null"===b(sessionStorage.getObject(this.name))&&sessionStorage.setObject(this.name,{session:Date.now(),recent:"",data:[]})}return _createClass(a,[{key:"_listen",value:function(a,b){a.addEventListener("change",function(a){var c=a.target.files[0];c&&b(c)})}},{key:"_formatIframe",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",d="";return"text"===a?d="\n          <pre>".concat(b,"</pre>\n        "):"image"===a?d="\n          <div style=\"display:flex;justify-content:center\">\n            <img src=\"".concat(b,"\" type=\"").concat(c,"\" />\n          </div>'\n        "):"audio"===a?d="\n          <div style=\"display:flex;justify-content:center;align-items:center;height:100%\">\n            <audio controls>\n              <source src=\"".concat(b,"\" type=\"").concat(c,"\">\n            </audio>\n          </div>'\n        "):"video"===a?d="\n          <video controls style=\"width:100%;height100%\">\n            <source src=\"".concat(b,"\" type=\"").concat(c,"\">\n          </video>\n        "):"pdf"===a?d="\n          <embed width=\"100%\" height=\"100%\" src=\"".concat(b,"\" type=\"").concat(c,"\" />\n        "):void 0,d}},{key:"storage_path",get:function(){for(var a=[],b=sessionStorage.getObject(this.name),c=Object.keys(b.data),d=0;d<c.length;d++)a.push(b.data[c[d]].path);return a}},{key:"storage_recent",get:function(){var a=sessionStorage.getObject(this.name);return 0===a.recent.length?"":a.recent}},{key:"capture",value:function(a,b){var d=this;this._listen(a,function(a){d.file_info.name=a.name,d.file_info.type=a.type,d.file_info.size=c(a.size),d.file_info.lastModified=a.lastModified;var e=new FileReader,f=a.type.split("/");d.file_mime.primary=f[0],d.file_mime.secondary=f[1],"text"===d.file_mime.primary&&(e.addEventListener("loadend",function(a){d.file_value=a.target.result,b()}),e.readAsText(a)),"image"===d.file_mime.primary&&(e.addEventListener("loadend",function(a){d.file_value=a.target.result,b()}),"svg+xml"===d.file_mime.secondary?e.readAsText(a):e.readAsDataURL(a)),("audio"===d.file_mime.primary||"video"===d.file_mime.primary)&&(e.addEventListener("loadend",function(a){d.file_value=a.target.result,b()}),e.readAsDataURL(a)),"application"===d.file_mime.primary&&"pdf"===d.file_mime.secondary&&(e.addEventListener("loadend",function(a){d.file_value=a.target.result,b()}),e.readAsDataURL(a))})}},{key:"capturePreview",value:function(a){"text"===this.file_mime.primary&&("html"===this.file_mime.secondary?this.file_content=this.file_value:this.file_content=this._formatIframe("text",this.file_value)),"image"===this.file_mime.primary&&("svg+xml"===this.file_mime.secondary?this.file_content=this.file_value:this.file_content=this._formatIframe("image",this.file_value,this.file_info.type)),"audio"===this.file_mime.primary&&(this.file_content=this._formatIframe("audio",this.file_value,this.file_info.type)),"video"===this.file_mime.primary&&(this.file_content=this._formatIframe("video",this.file_value,this.file_info.type)),"application"===this.file_mime.primary&&"pdf"===this.file_mime.secondary&&(this.file_content=this._formatIframe("pdf",this.file_value,this.file_info.type));var b=a.contentDocument||a.contentWindow.document;b.open(),b.write(this.file_content),b.close()}},{key:"save",value:function(){var a={path:this.file_info.name,content:{type:this.file_info.type,size:this.file_info.size,value:this.file_value}},b=sessionStorage.getObject(this.name);b.session=Date.now(),b.recent=this.file_info.name;for(var c,d=!1,e=Object.keys(b.data),f=0;f<e.length;f++)c=b.data[e[f]].path,c===this.file_info.name&&(d=!0,this.storage_exists=!0);d||(b.data.push(a),sessionStorage.setObject(this.name,b))}},{key:"retrieve",value:function(a){if("undefined"===b(a)&&(a=this.storage_recent),0!=a.length){for(var c,d=sessionStorage.getObject(this.name),e="",f=Object.keys(d.data),g=0;g<f.length;g++)c=d.data[f[g]].path,c===a&&(e=d.data[f[g]].content);return e}}},{key:"retrievePreview",value:function(a,b){var c=b.type.split("/"),d=c[0],e=c[1],f=a.contentDocument||a.contentWindow.document,g="";"text"===d&&("html"===e?g=b.value:g=this._formatIframe("text",b.value)),"image"===d&&("svg+xml"===e?g=b.value:g=this._formatIframe("image",b.value,b.type)),"audio"===this.file_mime.primary&&(g=this._formatIframe("audio",b.value,b.type)),"video"===this.file_mime.primary&&(g=this._formatIframe("video",b.value,b.type)),"application"===this.file_mime.primary&&"pdf"===e&&(g=this._formatIframe("pdf",b.value,b.type)),f.open(),f.write(g),f.close()}}]),a}();a.CPSR=d}(window);